"use strict";(self.webpackChunkiobroker_admin_component_telegram=self.webpackChunkiobroker_admin_component_telegram||[]).push([["src_ConfigCustomInstancesSelector_jsx"],{94976:(ce,D,E)=>{E.d(D,{A:()=>de});var q=E(28437),p=E.n(q),F=E(95973),x=E.n(F),W=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const O={randomUUID:W};var j,z=new Uint8Array(16);function M(){if(!j&&(j=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!j))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return j(z)}for(var y=[],I=0;I<256;++I)y.push((I+256).toString(16).slice(1));function R(n,e=0){return(y[n[e+0]]+y[n[e+1]]+y[n[e+2]]+y[n[e+3]]+"-"+y[n[e+4]]+y[n[e+5]]+"-"+y[n[e+6]]+y[n[e+7]]+"-"+y[n[e+8]]+y[n[e+9]]+"-"+y[n[e+10]]+y[n[e+11]]+y[n[e+12]]+y[n[e+13]]+y[n[e+14]]+y[n[e+15]]).toLowerCase()}function ue(n,e=0){var r=R(n,e);if(!validate(r))throw TypeError("Stringified UUID is invalid");return r}const pe=null;function B(n,e,r){if(O.randomUUID&&!e&&!n)return O.randomUUID();n=n||{};var c=n.random||(n.rng||M)();if(c[6]=c[6]&15|64,c[8]=c[8]&63|128,e){r=r||0;for(var u=0;u<16;++u)e[r+u]=c[u];return e}return R(c)}const T=B;var m=E(67085),V=E(21839),_=E(60556),k=E(37449),H=Object.defineProperty,L=Object.defineProperties,N=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,J=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable,X=Reflect.get,P=(n,e,r)=>e in n?H(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Y=(n,e)=>{for(var r in e||(e={}))K.call(e,r)&&P(n,r,e[r]);if(U)for(var r of U(e))Q.call(e,r)&&P(n,r,e[r]);return n},Z=(n,e)=>L(n,N(e)),ee=(n,e,r)=>X(J(n),r,e),A=(n,e,r)=>new Promise((c,u)=>{var d=t=>{try{s(r.next(t))}catch(l){u(l)}},a=t=>{try{s(r.throw(t))}catch(l){u(l)}},s=t=>t.done?c(t.value):Promise.resolve(t.value).then(d,a);s((r=r.apply(n,e)).next())});const g={table:{minWidth:400},header:{fontSize:16,fontWeight:"bold"},td:{padding:"2px 16px"}};function te(n,e){return A(this,null,function*(){const r=yield n.getObjectViewSystem("state",`${e}.`,`${e}.\u9999`),c=[],u=Object.keys(r).filter(d=>d.endsWith(".address"));for(let d=0;d<u.length;d++){const a=u[d],s=yield n.getState(a);s!=null&&s.val&&c.push({ip:s.val,name:"homekit-controller"})}return c})}function ie(n,e){return A(this,null,function*(){const r=yield n.getObjectViewSystem("state",`${e}.`,`${e}.\u9999`),c=[],u=Object.keys(r).filter(d=>d.endsWith(".address"));for(let d=0;d<u.length;d++){const a=u[d],s=yield n.getState(a);s!=null&&s.val&&c.push({ip:s.val,name:"homekit-controller"})}return c})}function ne(n,e){return A(this,null,function*(){const r=yield n.getObjectViewSystem("state",`${e}.`,`${e}.\u9999`),c=[],u=Object.keys(r).filter(d=>d.endsWith(".hostname"));for(let d=0;d<u.length;d++){const a=u[d],s=yield n.getState(a);s!=null&&s.val&&c.push({ip:s.val,name:"shelly"})}return c})}function ae(n,e){return A(this,null,function*(){var r,c;const u=yield n.getObjectViewSystem("state",`${e}.info.clients.`,`${e}.info.clients.\u9999`),d=[],a=Object.values(u);for(let s=0;s<a.length;s++)(c=(r=a[s])==null?void 0:r.native)!=null&&c.ip&&d.push({ip:a[s].native.ip,name:e.split(".")[0]});return d})}function se(n,e){return A(this,null,function*(){var r,c,u;const d=yield n.getObjectViewSystem("device",`${e}.`,`${e}.\u9999`),a=Object.values(d),s=[];for(let t=0;t<a.length;t++)((r=a[t])==null?void 0:r.type)==="device"&&((u=(c=a[t])==null?void 0:c.native)!=null&&u.ip)&&s.push({ip:a[t].native.ip,name:e.split(".")[0]});return s})}const re=[{adapter:"broadlink2",attr:"additional"},{adapter:"harmony",attr:"devices",arrayAttr:"ip"},{adapter:"hm-rpc",attr:"homematicAddress"},{adapter:"homeconnect",browse:ie},{adapter:"homekit-controller",attr:"discoverIp",browse:te},{adapter:"hue",attr:"bridge"},{adapter:"knx",attr:"bind"},{adapter:"lgtv",attr:"ip"},{adapter:"loxone",attr:"host"},{adapter:"mihome-vacuum",attr:"ip"},{adapter:"modbus",attr:"params.bind",clients:!0},{adapter:"mqtt",attr:"url",clients:!0},{adapter:"mqtt-client",attr:"host"},{adapter:"lcn",attr:"host"},{adapter:"knx",attr:"gwip"},{adapter:"onvif"},{adapter:"openknx",attr:"gwip"},{adapter:"broadlink2",attr:"additional"},{adapter:"proxmox",attr:"ip"},{adapter:"samsung",attr:"ip"},{adapter:"shelly",browse:ne},{adapter:"sonoff",clients:!0},{adapter:"sonos",attr:"devices",arrayAttr:"ip"},{adapter:"tr-064",attr:"iporhost"},{adapter:"unify",attr:"controllerIp"},{adapter:"upnp",browse:se},{adapter:"wled",attr:"devices",arrayAttr:"ip"},{adapter:"wifilight",attr:"devices",arrayAttr:"ip"}];function S(n){return n?typeof n!="string"?!1:(n=n.trim().toUpperCase().replace(/\s/g,""),!n||n.match(/^([0-9A-F]{2}[:-]){5}([0-9A-F]{2})$/)?!0:!!n.match(/^([0-9A-F]{12})$/)):!0}function G(n){return S(n)?(n=n.toUpperCase().trim().replace(/[\s:-]/g,""),n.replace(/(..)(..)(..)(..)(..)(..)/,"$1:$2:$3:$4:$5:$6")):n}function w(n){return n?typeof n!="string"?!1:(n=n.trim(),n?n.match(/^\d+\.\d+\.\d+\.\d+$/)?!n.trim().split(".").map(r=>parseInt(r,10)).find(r=>r<0||r>255):!1:!0):!0}function le(n){return w(n)?n.trim().split(".").map(r=>parseInt(r,10)).join("."):n}class C extends _.ConfigGeneric{componentDidMount(){return A(this,null,function*(){ee(C.prototype,this,"componentDidMount").call(this);let e=[];const r=yield this.props.socket.getObject(`system.adapter.kisshome-research.${this.props.instance}`);r!=null&&r.common.host&&(e=(yield this.props.socket.getObject(`system.host.${r.common.host}`)).common.address);let c=yield this.props.socket.getAdapterInstances();c=c.filter(s=>{var t;return((t=s==null?void 0:s.common)==null?void 0:t.adminUI)&&(s.common.adminUI.config!=="none"||s.common.adminUI.tab)}).map(s=>({id:s._id.replace(/^system\.adapter\./,""),name:s.common.name,native:s.native})).sort((s,t)=>s.id>t.id?1:s.id<t.id?-1:0);const u=_.ConfigGeneric.getValue(this.props.data,"devices")||[];u.forEach(s=>{s.uuid||(s.uuid=T())});const d=yield this.collectIpAddresses(c,e,u),a={instances:c,ips:d};if(this.props.alive){const s=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]];a.runningRequest=!0,this.props.socket.sendTo(`kisshome-research.${this.props.instance}`,"getMacForIps",s).then(t=>{var l;let f=!1;const o={};(l=t==null?void 0:t.result)==null||l.forEach(h=>{const b=h.ip,$=d.findIndex(oe=>oe.ip===b);$!==-1&&(f=!0,d[$].mac=h.mac,o[h.mac]=h.vendor)});let v=!1;s.forEach(h=>{const b=d.findIndex($=>$.ip===h.ip);b!==-1&&(h.mac!==d[b].mac&&(v=!0),o[h.mac]||(o[h.mac]=d[b].vendor,f=!0))}),f?this.setState({ips:d,vendors:o,runningRequest:!1}):this.setState({runningRequest:!1}),v&&this.onChange("devices",s)}).catch(t=>{t.toString()!=="no results"&&window.alert(`Cannot get MAC addresses: ${t}`),this.setState({runningRequest:!1})})}this.setState(a)})}static getAttr(e,r){if(Array.isArray(r)){const c=r.shift();return typeof e[c]=="object"?C.getAttr(e[c],r):r.length?null:e[c]}return C.getAttr(e,r.split("."))}static isIp(e){if(typeof e=="string"){if(e.match(/^\d+\.\d+\.\d+\.\d+$/))return"ipv4";if(e.match(/^[\da-fA-F:]+$/))return"ipv6"}return null}componentWillUnmount(){super.componentWillUnmount(),this.validateTimeout&&clearTimeout(this.validateTimeout),this.validateTimeout=null}validateAddresses(){this.validateTimeout&&clearTimeout(this.validateTimeout),this.validateTimeout=setTimeout(()=>{this.validateTimeout=null},1e3)}collectIpAddresses(e,r,c){return A(this,null,function*(){let u=[];e=e||this.state.instances;for(let a=0;a<e.length;a++){const s=re.find(t=>t.adapter===e[a].name);if(s&&e[a].native){const t=s.attr;if(s.attr&&e[a].native[t])if(s.arrayAttr){if(Array.isArray(e[a].native[t]))for(let l=0;l<e[a].native[t].length;l++){const f=e[a].native[t][l],o=C.getAttr(f,s.arrayAttr),v=C.isIp(o);if(v){const h=c.find(b=>b.ip===o);u.push({ip:o,type:v,desc:e[a].name,uuid:(h==null?void 0:h.uuid)||T()})}}}else{const l=C.getAttr(e[a].native,t),f=C.isIp(l);if(f){const o=c.find(v=>v.ip===l);u.push({ip:l,type:f,desc:e[a].name,uuid:(o==null?void 0:o.uuid)||T()})}}if(s.browse)try{(yield s.browse(this.props.socket,e[a]._id.replace("system.adapter.",""))).forEach(f=>{const o=C.isIp(f.ip);if(o){const v=c.find(h=>h.ip===f.ip);u.push({ip:f.ip,type:o,desc:f.name||e[a].name,uuid:(v==null?void 0:v.uuid)||T()})}})}catch(l){console.error(`Cannot collect "${e[a]}": ${l}`)}if(s.clients)try{(yield ae(this.props.socket,e[a]._id.replace("system.adapter.",""))).forEach(f=>{const o=C.isIp(f.ip);if(o){const v=c.find(h=>h.ip===f.ip);u.push({ip:f.ip,type:o,desc:f.name||e[a].name,uuid:(v==null?void 0:v.uuid)||T()})}})}catch(l){console.error(`Cannot collect "${e[a]}": ${l}`)}}else if(e[a].native.ip&&typeof e[a].native.ip=="string"&&e[a].native.ip.match(/^\d+\.\d+\.\d+\.\d+$/)){const t=c.find(l=>l.ip===e[a].native.ip);u.push({ip:e[a].native.ip,type:"ipv4",desc:e[a].name,uuid:(t==null?void 0:t.uuid)||T()})}else if(e[a].native.host&&typeof e[a].native.host=="string"&&e[a].native.host.match(/^\d+\.\d+\.\d+\.\d+$/)){const t=c.find(l=>l.ip===e[a].native.host);u.push({ip:e[a].native.host,type:"ipv4",desc:e[a].name,uuid:(t==null?void 0:t.uuid)||T()})}}u=u.filter(a=>!r.includes(a.ip)&&a.ip!=="0.0.0.0"&&a.ip!=="localhost"&&a.ip!=="127.0.0.1"&&a.ip!=="::1"&&a.type==="ipv4");const d=[];for(let a=0;a<u.length;a++)d.find(s=>s.ip===u[a].ip)||d.push(u[a]);return d})}renderItem(e,r,c){var u;const d=_.ConfigGeneric.getValue(this.props.data,"devices")||[];d.forEach(t=>{t.uuid||(t.uuid=T())});const a=this.state.ips?d.filter(t=>!this.state.ips.find(l=>l.ip===t.ip)):d,s=d.every(t=>t.enabled)&&(this.state.ips?this.state.ips.every(t=>d.find(l=>l.ip===t.ip)):!0);return p().createElement(m.TableContainer,null,this.state.runningRequest?p().createElement(m.LinearProgress,null):p().createElement("div",{style:{height:2,width:"100%"}}),p().createElement(m.Table,{style:g.table,size:"small"},p().createElement(m.TableHead,null,p().createElement(m.TableRow,null,p().createElement(m.TableCell,{style:Z(Y({},g.header),{width:120})},p().createElement(m.Checkbox,{title:s?k.i18n.t("custom_kisshome_unselect_all"):k.i18n.t("custom_kisshome_select_all"),checked:s,indeterminate:!s&&d.length>0,disabled:this.state.runningRequest,onClick:()=>{const t=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]];if(s){t.forEach(l=>l.enabled=!1);for(let l=t.length-1;l>=0;l--)this.state.ips.find(f=>f.ip===t[l].ip)&&t.splice(l,1)}else t.forEach(l=>l.enabled=!0),this.state.ips.forEach(l=>{t.find(f=>l.ip===f.ip)||t.push({ip:l.ip,mac:l.mac,desc:l.desc,enabled:!0,uuid:l.uuid})}),t.forEach(l=>l.enabled=!0);this.onChange("devices",t)}}),p().createElement(m.Fab,{onClick:()=>{const t=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]];t.push({ip:"",mac:"",desc:"",enabled:!0,uuid:T()}),this.onChange("devices",t)},size:"small",disabled:this.state.runningRequest},p().createElement(V.Add,null))),p().createElement(m.TableCell,{style:g.header},k.i18n.t("custom_kisshome_ip")),p().createElement(m.TableCell,{style:g.header},k.i18n.t("custom_kisshome_mac")),p().createElement(m.TableCell,{style:g.header},k.i18n.t("custom_kisshome_vendor")),p().createElement(m.TableCell,{style:g.header},k.i18n.t("custom_kisshome_name")),p().createElement(m.TableCell,{style:g.header}))),p().createElement(m.TableBody,null,(u=this.state.ips)==null?void 0:u.map(t=>{var l,f;return p().createElement(m.TableRow,{key:t.uuid},p().createElement(m.TableCell,{scope:"row",style:g.td},p().createElement(m.Checkbox,{checked:!!((l=d.find(o=>o.ip===t.ip))!=null&&l.enabled),disabled:this.state.runningRequest,onClick:()=>{const o=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]],v=o.findIndex(h=>h.ip===t.ip);v===-1?o.push({ip:t.ip,mac:t.mac,desc:t.desc,enabled:!0,uuid:t.uuid}):o.splice(v,1),this.onChange("devices",o)}})),p().createElement(m.TableCell,{style:g.td},t.ip),p().createElement(m.TableCell,{style:g.td},t.mac||""),p().createElement(m.TableCell,{style:g.td},((f=this.state.vendors)==null?void 0:f[t.mac])||""),p().createElement(m.TableCell,{style:g.td},t.desc),p().createElement(m.TableCell,{style:g.td}))}),a.map(t=>{var l,f;return p().createElement(m.TableRow,{key:t.uuid},p().createElement(m.TableCell,{scope:"row",style:g.td},p().createElement(m.Checkbox,{checked:!!((l=d.find(o=>o.ip===t.ip))!=null&&l.enabled),disabled:this.state.runningRequest,onClick:()=>{const o=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]],v=o.find(h=>h.uuid===t.uuid);v&&(v.enabled=!v.enabled,this.onChange("devices",o))}})),p().createElement(m.TableCell,{style:g.td},p().createElement(m.TextField,{fullWidth:!0,error:!w(t.ip),value:t.ip,disabled:this.state.runningRequest,placeholder:"192.168.x.y",onChange:o=>{const v=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]],h=v.find(b=>b.uuid===t.uuid);h&&(h.ip=o.target.value,this.onChange("devices",v),this.validateAddresses())},onBlur:()=>{if(t.ip.trim()){const o=le(t.ip);if(o!==t.ip){const v=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]],h=v.find(b=>b.uuid===t.uuid);h&&(h.ip=o,this.onChange("devices",v))}}},variant:"standard"})),p().createElement(m.TableCell,{style:g.td},p().createElement(m.TextField,{fullWidth:!0,value:t.mac,disabled:this.state.runningRequest,error:!S(t.mac),placeholder:"00:11:22:33:44:55",onChange:o=>{const v=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]],h=v.find(b=>b.uuid===t.uuid);h&&(h.mac=o.target.value,this.onChange("devices",v),this.validateAddresses())},onBlur:()=>{if(t.mac.trim()){const o=G(t.mac);if(o!==t.mac){const v=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]],h=v.find(b=>b.uuid===t.uuid);h&&(h.mac=o,this.onChange("devices",v))}}},variant:"standard"})),p().createElement(m.TableCell,{style:g.td},((f=this.state.vendors)==null?void 0:f[G(t.mac)])||""),p().createElement(m.TableCell,{style:g.td},p().createElement(m.TextField,{fullWidth:!0,value:t.desc,disabled:this.state.runningRequest,onChange:o=>{const v=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]],h=v.find(b=>b.uuid===t.uuid);h&&(h.desc=o.target.value,this.onChange("devices",v))},variant:"standard"})),p().createElement(m.TableCell,{style:g.td},p().createElement(m.IconButton,{disabled:this.state.runningRequest,onClick:()=>{const o=[..._.ConfigGeneric.getValue(this.props.data,"devices")||[]];o.findIndex(h=>h.uuid===t.uuid)!==-1&&(o.splice(i,1),this.onChange("devices",o))}},p().createElement(V.Delete,null))))}))))}}C.propTypes={socket:x().object.isRequired,themeType:x().string,themeName:x().string,style:x().object,data:x().object.isRequired,schema:x().object,onError:x().func,onChange:x().func};const de=C}}]);

//# sourceMappingURL=src_ConfigCustomInstancesSelector_jsx.0b7c3813.chunk.js.map